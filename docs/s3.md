# s3

Add s3 support for deployment specific files

## Activation
Requires directory
- `s3`

## Substitution
- `s3/**/*.yaml`
- `s3/**/*.yml`
- `s3/**/*.properties`

The following environments will be provided for substitution:
- `DEPLOYMENT_AWS_S3_BUCKET`
  The name of the S3 bucket that will be used for your S3 content.
- `DEPLOYMENT_AWS_S3_FOLDER`
  A unique folder name for your S3 content in the `DEPLOYMENT_AWS_S3_BUCKET`

## Configuration
Simply create an `s3` directory in your deployment unit. The structure will be copied to a unique folder in S3.

Example
```
├── s3
│   ├── data-query
│   │   ├── application.properties
│   │   └── greeting-message.txt
│   └── kong
│       └── kong.yml
```

Then in your `docker-compose.yml`, you pass the S3 location as environment variables.
```
version: '3'
services:
  exemplar:
    image: vasdvp/awesome-app:$AWESOME_VERSION
    ports:
      - "8080:8080"
    environment:
      MY_BUCKET_NAME: "$DEPLOYMENT_AWS_S3_BUCKET"
      MY_FOLDER: "$DEPLOYMENT_AWS_S3_FOLDER"
```


## Lifecycles
- `initialize`
  - Defines deployment substitution variables for bucket and folder
- `before-deploy-green`
  - Performs substition on `s3` directory contents
- `deploy-green`
  - Creates bucket and folder, then transfer `s3` content
- `after-verify-blue`
  - Removes previous deployment s3 content

### Rollback Lifecycles
- `rollback`
  - Removes green s3 content