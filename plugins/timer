#!/usr/bin/env bash
. $PLUGIN_LIB

TIMER_FILES=( $(find $DU_DIR -name "timer-*.json") )

on-activate() {
  if [ ${#TIMER_FILES[@]} -eq 0 ]; then return $PLUGIN_DISABLED; fi
  return $PLUGIN_ENABLED
}

on-initialize() {
  for timer in ${TIMER_FILES[@]}
  do
    substitute-env rewrite -e $PLUGIN_SUBSTITION_DIR -f $timer
  done
}

on-undeploy() {
  env | sort
  callculon remove-all
}

on-deploy() {
  for timer in ${TIMER_FILES[@]}
  do
    callculon create --configuration $timer
  done
}

main "$@"
exit 1
